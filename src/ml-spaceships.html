<link rel="import"
      href="../bower_components/polymer/polymer.html">
<link rel="import"
      href="ml-shared-styles.html">
<link rel="import"
      href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import"
      href="../bower_components/iron-image/iron-image.html">
<link rel="import"
      href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import"
      href="behaviors/ml-spaceship-images.html">
<link rel="import"
      href="../bower_components/paper-card/paper-card.html">
<link rel="import"
      href="../bower_components/iron-list/iron-list.html">

<dom-module id="ml-spaceships">
	<style is="custom-style"
	       include="iron-flex iron-flex-alignment shared-styles">
		.futurepanel {
			z-index: 1;
			margin: auto;
			top: 0;
			right: 0;
			bottom: 0;
			left: 0;
			width: 95%;
			height: 90%;
			margin-top: 4em;
			margin-bottom: 4em;
			border-radius: 7px;
		}

		.heading {
			text-align: center;
			-webkit-animation: tracking-in-contract-bck 1s cubic-bezier(0.215, 0.610, 0.355, 1.000) both;
			-moz-animation: tracking-in-contract-bck 1s cubic-bezier(0.215, 0.610, 0.355, 1.000) both;
			animation: tracking-in-contract-bck 1s cubic-bezier(0.215, 0.610, 0.355, 1.000) both;
			animation-delay: 0.7s;
		}

		.item-column {
			-webkit-column-count: 2;
			/* Chrome, Safari, Opera */
			-moz-column-count: 2;
			/* Firefox */
			column-count: 2;
			-webkit-column-gap: 40px;
			/* Chrome, Safari, Opera */
			-moz-column-gap: 40px;
			/* Firefox */
			column-gap: 40px;
			margin-top: 2.5em;
			text-align: center;
		}

		iron-image {
			width: 35em;
			height: 20em;
		}

		iron-image:hover {
			-webkit-animation: shadow-drop-2-center 0.4s cubic-bezier(0.250, 0.460, 0.450, 0.940) both;
			-moz-animation: shadow-drop-2-center 0.4s cubic-bezier(0.250, 0.460, 0.450, 0.940) both;
			animation: shadow-drop-2-center 0.4s cubic-bezier(0.250, 0.460, 0.450, 0.940) both;
		}

		.tracking-in-contract-bck {
			-webkit-animation: tracking-in-contract-bck 1s cubic-bezier(0.215, 0.610, 0.355, 1.000) both;
			-moz-animation: tracking-in-contract-bck 1s cubic-bezier(0.215, 0.610, 0.355, 1.000) both;
			animation: tracking-in-contract-bck 1s cubic-bezier(0.215, 0.610, 0.355, 1.000) both;
		}

		@-webkit-keyframes shadow-drop-2-center {
			0% {
				-webkit-transform: translateZ(0);
				transform: translateZ(0);
				box-shadow: 0 0 0 0 transparent
			}
			100% {
				-webkit-transform: translateZ(50px);
				transform: translateZ(50px);
				box-shadow: 0 0 20px 0 rgba(0, 0, 0, .90)
			}
		}

		@keyframes shadow-drop-2-center {
			0% {
				-webkit-transform: translateZ(0);
				transform: translateZ(0);
				box-shadow: 0 0 0 0 transparent
			}
			100% {
				-webkit-transform: translateZ(50px);
				transform: translateZ(50px);
				box-shadow: 0 0 20px 0 rgba(0, 0, 0, .90)
			}
		}

		@-webkit-keyframes tracking-in-contract-bck {
			0% {
				letter-spacing: 1em;
				-webkit-transform: translateZ(400px);
				transform: translateZ(400px);
				opacity: 0
			}
			40% {
				opacity: .6
			}
			100% {
				-webkit-transform: translateZ(0);
				transform: translateZ(0);
				opacity: 1
			}
		}

		@keyframes tracking-in-contract-bck {
			0% {
				letter-spacing: 1em;
				-webkit-transform: translateZ(400px);
				transform: translateZ(400px);
				opacity: 0
			}
			40% {
				opacity: .6
			}
			100% {
				-webkit-transform: translateZ(0);
				transform: translateZ(0);
				opacity: 1
			}
		}
	</style>

	<template>
		<iron-ajax id="emporiumEndpoint"
		           method="GET"
		           auto
		           url="http://demo7475333.mockable.io/spaceships"
		           handle-as="json"
		           on-response="handleResponse"
		           on-error="handleError">
		</iron-ajax>
		<div class="futurepanel">
			<h1 class="heading">Watto's Space Emporium</h1>
			<div class="item-column">
				<template is="dom-repeat"
				          items="{{spaceships}}">

					<div class="futurepanel__body">
						<a href$="{{item.profileUrl}}">
							<iron-image src="{{item.imgUrl}}"
							            sizing="cover"></iron-image>
						</a>
						<div class="text-container">
							<p>{{item.name}}</p>
						</div>
					</div>
				</template>
			</div>
		</div>
	</template>
	<script>
		Polymer({
			is: 'ml-spaceships',
			behaviors: [Behaviors.SpaceShipImagesBehavior],
			properties: {
				spaceships: {
					type: Array,
					value: function() {
						return [];
					}
				},
			},
			_formatRouteName: function(name) {
				return name.split(' ').join("-");
			},
			_shipProfileUrl: function(data) {
				var url = window.location.origin + '/spaceship-profile/';
				data.forEach(function(ship) {
					ship.profileUrl = url + this._formatRouteName(ship.name);
					ship.imgUrl = this._shipImageUrl(ship.name, this.shipImages);
				}, this);
				return data;
			},
			_shipImageUrl: function(name, images) {
				result = images.filter(function(img) { return img.name === name })[0].url;
				return result;
			},
			_setSessionStorage: function(data) {
				data = JSON.stringify(data);
				sessionStorage.setItem('spaceships', data);
			},
			_queryEmporiumData: function() {
				this.$.emporiumEndpoint.generateRequest();
			},
			handleResponse: function(payload) {
				var payload = payload.detail.__data__.response.products
				this.spaceships = this._shipProfileUrl(payload);
				this._setSessionStorage(this.spaceships);
			},
			handleError: function(err) {
				console.log(error);
			}
		});
	</script>
</dom-module>